# AutoU Email Classifier

[![Deploy on Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

Sistema inteligente de classifica√ß√£o de emails que combina IA (OpenAI GPT) com heur√≠sticas para categorizar emails automaticamente.

## üöÄ Quick Start

### Usando Docker (Recomendado)

1. **Setup inicial**:
```bash
# Clonar e configurar
git clone <repository_url>
cd Processo_Seletivo

# Setup autom√°tico do ambiente
./scripts/dev-setup.sh
```

2. **Configurar vari√°veis de ambiente**:
```bash
# Editar .env e adicionar sua chave da OpenAI
nano .env
# Adicionar: OPENAI_API_KEY=sk-...
```

3. **Executar aplica√ß√£o**:
```bash
# Desenvolvimento (com hot reload)
docker-compose up app-dev

# Produ√ß√£o
docker-compose up app
```

4. **Acessar aplica√ß√£o**: http://localhost:8000

### Desenvolvimento Local

```bash
# Testes
./scripts/build-and-test.sh

# Testes com linting
./scripts/build-and-test.sh --lint

# Apenas linting
docker-compose --profile lint run --rm lint

# Apenas testes
docker-compose --profile test run --rm test
```

## üèóÔ∏è Arquitetura

### Estrutura do Projeto
```
‚îú‚îÄ‚îÄ app/                    # C√≥digo da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ core/              # Configura√ß√£o e logging
‚îÇ   ‚îú‚îÄ‚îÄ services/          # L√≥gica de neg√≥cio (AI, NLP, Heur√≠sticas)
‚îÇ   ‚îú‚îÄ‚îÄ utils/             # Utilit√°rios (PDF, TXT)
‚îÇ   ‚îî‚îÄ‚îÄ web/               # Rotas e templates
‚îú‚îÄ‚îÄ scripts/               # Scripts de automa√ß√£o
‚îú‚îÄ‚îÄ tests/                 # Testes automatizados
‚îî‚îÄ‚îÄ docker-compose.yml     # Orquestra√ß√£o de containers
```

### Componentes Principais

1. **AI Service** (`app/services/ai.py`)
   - Integra√ß√£o com OpenAI GPT-4o-mini
   - Fallback para heur√≠sticas quando necess√°rio
   - Sistema de cache e retry

2. **Heuristics Service** (`app/services/heuristics.py`)
   - Classifica√ß√£o baseada em palavras-chave
   - Backup quando AI n√£o est√° dispon√≠vel

3. **NLP Service** (`app/services/nlp.py`)
   - Processamento de texto com spaCy e NLTK
   - An√°lise de sentimento e entidades

4. **Web Interface** (`app/web/`)
   - Interface FastAPI com Jinja2
   - Upload de arquivos (PDF, TXT)
   - Dashboard de resultados

## üê≥ Docker & CI/CD

### Configura√ß√£o Multi-stage

- **Development**: Ambiente completo com ferramentas de teste
- **Production**: Imagem otimizada apenas com depend√™ncias necess√°rias

### Scripts Dispon√≠veis

| Script | Descri√ß√£o |
|--------|-----------|
| `./scripts/dev-setup.sh` | Configura√ß√£o inicial do ambiente |
| `./scripts/build-and-test.sh` | Build e testes automatizados |
| `./scripts/deploy.sh` | Deploy em produ√ß√£o com rollback |

### Docker Compose Profiles

```bash
# Aplica√ß√£o principal
docker-compose up app                    # Produ√ß√£o
docker-compose up app-dev                # Desenvolvimento

# Testes e qualidade
docker-compose --profile test run test   # Testes unit√°rios
docker-compose --profile lint run lint   # Linting e formata√ß√£o
```

## üß™ Testes

### Execu√ß√£o de Testes

```bash
# Todos os testes (110 testes, 87% cobertura)
./scripts/build-and-test.sh

# Testes espec√≠ficos
pytest tests/test_units.py -v
pytest tests/test_integration.py -v
pytest tests/test_performance.py -v
```

### Status dos Testes

‚úÖ **110/110 testes passando** (100% success rate)

### Breakdown por Categoria:
- ‚úÖ **Units**: 35 testes - L√≥gica de neg√≥cio core
- ‚úÖ **Integration**: 14 testes - Integra√ß√£o entre componentes  
- ‚úÖ **Routes**: 11 testes - Endpoints da API
- ‚úÖ **Utils**: 4 testes - Utilit√°rios (PDF/TXT)
- ‚úÖ **Requirements**: 17 testes - Valida√ß√£o de depend√™ncias
- ‚úÖ **NLP**: 4 testes - Processamento de linguagem
- ‚úÖ **Heuristics**: 2 testes - L√≥gica de fallback
- ‚úÖ **Performance**: 11 testes - Benchmarks e limites
- ‚úÖ **AI Improvements**: 12 testes - Melhorias de IA

### Cobertura de Testes

- **Total**: 87% de cobertura
- **110 testes** cobrindo todas as funcionalidades
- Relat√≥rios HTML e XML gerados automaticamente

## üìä Monitoramento

### Health Check
- **Endpoint**: `/health`
- **Status**: Verifica conectividade da API
- **M√©tricas**: Tempo de resposta e disponibilidade

### Logging
- **N√≠veis**: DEBUG, INFO, WARNING, ERROR, CRITICAL
- **Formato**: JSON estruturado em produ√ß√£o
- **Rota√ß√£o**: Configurada automaticamente

## üîß Configura√ß√£o

### Vari√°veis de Ambiente (.env)

```bash
# OpenAI Configuration
OPENAI_API_KEY=your_api_key_here
OPENAI_MODEL=gpt-4o-mini

# Application Configuration
APP_ENV=production
DEBUG=false
LOG_LEVEL=INFO
HOST=0.0.0.0
PORT=8000

# AI Configuration
USE_HEURISTIC_FALLBACK=true
CONFIDENCE_THRESHOLD=0.7
```

### Personalizando Classifica√ß√£o

1. **Palavras-chave Heur√≠sticas**:
   - Edite as vari√°veis `HEURISTIC_KEYWORDS_*` no `.env`
   - Formato: palavras separadas por v√≠rgula

2. **Prompts da IA**:
   - Modifique `app/services/prompt_templates.py`
   - Ajuste os prompts para seu dom√≠nio espec√≠fico

3. **Limiares de Confian√ßa**:
   - Configure `CONFIDENCE_THRESHOLD` (0.0-1.0)
   - Valores mais altos = classifica√ß√µes mais conservadoras

## üìÅ Formatos Suportados

- **Texto**: `.txt` (UTF-8, Latin-1, CP1252)
- **PDF**: Extra√ß√£o autom√°tica de texto
- **Email**: An√°lise de assunto e conte√∫do

### Sa√≠da
```json
{
  "category": "urgente",
  "confidence": 0.95,
  "method": "ai",
  "reasoning": "Email cont√©m palavras indicativas de urg√™ncia...",
  "timestamp": "2024-01-20T10:30:00Z"
}
```

## üöÄ API Reference

### POST `/classify/text`
Classifica texto diretamente
```bash
curl -X POST http://localhost:8000/classify/text \
  -H "Content-Type: application/json" \
  -d '{"text": "Preciso de ajuda urgente com o sistema"}'
```

### POST `/classify/file`
Classifica arquivo (TXT/PDF)
```bash
curl -X POST http://localhost:8000/classify/file \
  -F "file=@email.pdf"
```

### GET `/health`
Status da aplica√ß√£o
```bash
curl http://localhost:8000/health
```

### GET `/docs`
Documenta√ß√£o interativa da API (Swagger UI)

## üöÄ Deploy em Produ√ß√£o

### Deploy Local

```bash
# Deploy autom√°tico com rollback
./scripts/deploy.sh

# Deploy personalizado
./scripts/deploy.sh --port 8080 --no-backup
```

### Deploy em Cloud

O projeto inclui configura√ß√£o para:
- **Docker Hub**: Build autom√°tico de imagens
- **GitHub Actions**: CI/CD completo
- **Render/Heroku**: Deploy direto via `render.yaml`

### GitHub Actions CI/CD

Pipeline completo incluindo:
- Lint e formata√ß√£o de c√≥digo
- Testes unit√°rios e integra√ß√£o
- Build de imagens Docker multi-plataforma
- Deploy autom√°tico
- Scanning de seguran√ßa

## üîí Seguran√ßa

### Implementa√ß√µes de Seguran√ßa

- **Container n√£o-root**: Usu√°rio dedicado (uid 1000)
- **Valida√ß√£o de input**: Sanitiza√ß√£o rigorosa
- **Rate limiting**: Prote√ß√£o contra abuso
- **Secrets**: Vari√°veis sens√≠veis via environment

### Scanning de Vulnerabilidades

```bash
# Verifica√ß√£o autom√°tica no CI/CD
# Manual:
docker scout quickview autou-classifier:production
```

## üõ†Ô∏è Troubleshooting

### Problemas Comuns

1. **Erro de API Key**:
   ```bash
   # Verificar configura√ß√£o
   grep OPENAI_API_KEY .env
   ```

2. **Container n√£o inicia**:
   ```bash
   # Verificar logs
   docker logs autou-classifier-prod
   ```

3. **Testes falhando**:
   ```bash
   # Rebuild completo
   docker-compose down --volumes
   docker-compose build --no-cache
   ```

### Comandos √öteis

```bash
# Status dos containers
docker ps --filter name=autou-classifier

# Logs em tempo real
docker logs -f autou-classifier-prod

# Acesso ao container
docker exec -it autou-classifier-prod bash

# Limpeza completa
docker system prune -af
```

## üìà Performance

### Benchmarks

- **Classifica√ß√£o simples**: ~2-5 segundos
- **Processamento PDF**: ~10-30 segundos
- **Throughput**: ~10-20 emails/minuto

### Otimiza√ß√µes

- **Cache**: Resultados de classifica√ß√£o em mem√≥ria
- **Batch processing**: M√∫ltiplos emails em paralelo
- **Fallback**: Heur√≠sticas quando IA est√° lenta

### Limites Configurados
- **Tamanho m√°ximo**: 2MB por arquivo
- **Caracteres**: 5.000 por texto
- **Timeout**: 30 segundos por classifica√ß√£o

## üéØ Casos de Uso

### 1. Triagem de Emails Corporativos
```python
# Exemplo de integra√ß√£o
import httpx

async with httpx.AsyncClient() as client:
    response = await client.post(
        "http://localhost:8000/classify/text",
        json={"text": email_content}
    )
    classification = response.json()
    
    if classification["category"] == "urgente":
        # Escalar para equipe
        escalate_to_team(email_content)
```

### 2. Processamento em Lote
```bash
# Classificar m√∫ltiplos arquivos
for file in *.pdf; do
    curl -X POST http://localhost:8000/classify/file \
         -F "file=@$file" \
         >> results.jsonl
done
```

### 3. Dashboard de Monitoramento
Interface web fornece:
- Upload de arquivos
- Classifica√ß√£o em tempo real
- Hist√≥rico de classifica√ß√µes
- M√©tricas de confian√ßa

## ü§ù Contribui√ß√£o

### Setup de Desenvolvimento

1. Fork do reposit√≥rio
2. `./scripts/dev-setup.sh`
3. Criar branch: `git checkout -b feature/nova-funcionalidade`
4. Desenvolver e testar: `./scripts/build-and-test.sh --lint`
5. Commit e push
6. Abrir Pull Request

### Padr√µes de C√≥digo

- **Formata√ß√£o**: Black + isort
- **Linting**: flake8
- **Testes**: pytest com 85%+ cobertura
- **Commits**: Conventional Commits

## üìö Recursos Adicionais

- [Documenta√ß√£o da API](http://localhost:8000/docs)
- [Cobertura de Testes](htmlcov/index.html)
- [Docker Setup](DOCKER_SETUP.md)
- [Melhorias de IA](AI_IMPROVEMENTS.md)

## üöÄ Roadmap & Melhorias

### Implementa√ß√µes Recentes ‚úÖ
- [x] Sistema de cache para otimiza√ß√£o
- [x] Batch processing para m√∫ltiplos emails
- [x] Interface web melhorada
- [x] M√©tricas de confidence
- [x] Fallback robusto para heur√≠sticas
- [x] Docker containerization completa
- [x] CI/CD pipeline com GitHub Actions
- [x] Scripts de automa√ß√£o para desenvolvimento

### Pr√≥ximas Features üîÑ
- [ ] Suporte a mais formatos (DOCX, MSG)
- [ ] API de feedback para aprendizado
- [ ] Dashboard analytics
- [ ] Integra√ß√£o com sistemas de email
- [ ] Modelo custom fine-tuned

## üìù Licen√ßa

Este projeto foi desenvolvido para o processo seletivo da AutoU.

---

**Desenvolvido com ‚ù§Ô∏è para AutoU** | **Status**: ‚úÖ Pronto para Produ√ß√£o | **Docker**: ‚úÖ Containerizado | **CI/CD**: ‚úÖ GitHub Actions
